<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แดชบอร์ดสรุปข้อมูล Wi-Fi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f2f5;
        }
        .chart-container {
            position: relative;
            width: 100%;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            padding: 1.5rem;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        .header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1a202c;
        }
        .sub-header {
            font-size: 0.875rem;
            color: #718096;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center">
             <div>
                <h1 class="text-3xl font-bold text-gray-800">แดชบอร์ดสรุปข้อมูล Wi-Fi</h1>
                <p class="text-gray-500 mt-1">ภาพรวมประสิทธิภาพและปัญหาของระบบ Wi-Fi ประจำเดือน</p>
             </div>
             <button class="mt-4 sm:mt-0 w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 flex items-center justify-center flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                ดาวน์โหลดรายงานฉบับเต็ม
            </button>
        </header>

        <!-- Main Layout -->
        <div class="flex flex-col gap-6">
            
            <!-- Section 1 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Wi-Fi Availability (รายเดือน) -->
                <div class="card">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="header-title">Wi-Fi Availability (รายเดือน)</h2>
                            <p class="sub-header">เปอร์เซ็นต์ความพร้อมใช้งานของสัญญาณ Wi-Fi</p>
                        </div>
                        <div class="text-right">
                             <p class="text-3xl font-bold text-teal-600" id="avgAvailability">0%</p>
                             <p class="text-sm text-gray-500">เฉลี่ยเดือนนี้</p>
                        </div>
                    </div>
                    <div class="mt-4 chart-container" style="height: 350px;">
                        <canvas id="availabilityChart"></canvas>
                    </div>
                </div>
                <!-- จำนวน Fault Wi-Fi แบ่งตาม Zone -->
                <div class="card">
                    <h2 class="header-title">จำนวน Fault Wi-Fi ตามโซน</h2>
                    <p class="sub-header">สัดส่วนปัญหาที่เกิดขึ้นในแต่ละพื้นที่</p>
                    <div class="mt-4 chart-container" style="height: 350px;">
                        <canvas id="faultZoneChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Section 2 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- สัดส่วนผู้ใช้งาน (Client) ตามภาค -->
                <div class="card">
                    <h3 class="header-title text-center">สัดส่วนผู้ใช้งาน (Client) ตามภาค</h3>
                    <div class="chart-container mt-2" style="height: 350px;">
                        <canvas id="regionClientChart"></canvas>
                    </div>
                </div>
                <!-- 10 อันดับจังหวัดตามปริมาณใช้งาน (Usage) -->
                <div class="card">
                    <h3 class="header-title text-center">10 อันดับจังหวัดตามปริมาณใช้งาน (Usage)</h3>
                    <div class="chart-container mt-2" style="height: 350px;">
                        <canvas id="provinceUsageChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Section 3: New Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                 <!-- สัดส่วนผู้ใช้งาน (Client) ตามจังหวัด -->
                 <div class="card">
                    <h3 class="header-title text-center">สัดส่วนผู้ใช้งาน (Client) ตามจังหวัด (Top 7)</h3>
                    <div class="chart-container mt-2" style="height: 350px;">
                        <canvas id="provinceClientChart"></canvas>
                    </div>
                </div>
                <!-- อันดับภาคตามปริมาณใช้งาน (Usage) -->
                <div class="card">
                    <h3 class="header-title text-center">อันดับภาคตามปริมาณใช้งาน (Usage)</h3>
                    <div class="chart-container mt-2" style="height: 350px;">
                        <canvas id="regionUsageChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Section 4 -->
            <div class="card">
                <h2 class="header-title">สรุปข้อมูลการใช้งานรายสาขา</h2>
                <p class="sub-header">20 อันดับแรกตามปริมาณการใช้งานและจำนวนผู้ใช้</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-12 mt-4">
                    <div>
                        <h3 class="font-bold text-center text-gray-700">ปริมาณการใช้งาน (Usage)</h3>
                        <div class="chart-container mt-2" style="height: 450px;">
                            <canvas id="topUsageChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-center text-gray-700">จำนวนผู้ใช้ (Client)</h3>
                        <div class="chart-container mt-2" style="height: 450px;">
                            <canvas id="topUsersChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section 5: Lowest Availability -->
            <div class="card">
                <h2 class="header-title text-center">10 อันดับสาขาที่ Availability ต่ำที่สุด</h2>
                <div class="chart-container mt-2" style="height: 350px;">
                    <canvas id="lowestAvailabilityChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- Professional Color Palette ---
        const professionalColors = ['#36A2EB', '#4BC0C0', '#FFCD56', '#FF9F40', '#9966FF', '#C9CBCF', '#FF6384', '#A9A9A9'];
        const primaryColor = 'rgba(54, 162, 235, 0.8)'; // Blue
        const primaryBorderColor = 'rgba(54, 162, 235, 1)';
        const secondaryColor = 'rgba(75, 192, 192, 0.8)'; // Teal
        const secondaryBorderColor = 'rgba(75, 192, 192, 1)';
        const accentColor = 'rgba(255, 159, 64, 0.8)'; // Orange
        const accentBorderColor = 'rgba(255, 159, 64, 1)';
        const dangerColor = 'rgba(255, 99, 132, 0.8)'; // Red
        const dangerBorderColor = 'rgba(255, 99, 132, 1)';

        // --- Mock Data for Faults ---
        const faultZones = ['กรุงเทพและปริมณฑล', 'ภาคเหนือ', 'ภาคตะวันออกเฉียงเหนือ', 'ภาคกลาง', 'ภาคตะวันออก', 'ภาคใต้'];
        const faultData = [120, 55, 80, 60, 45, 70];

        // --- Data from User's CSV ---
        const allBranchesData = [
            { name: '7-11 มรภ.ราชนครินทร์ บางคล้า (9480)', province: 'ฉะเชิงเทรา', region: 'ภาคตะวันออก', usage: 207.58, client: 166, date: '2025-08-01', availability: 53.3 },
            { name: '7-11 หมู่บ้านหงส์ประยูร (3118)', province: 'นนทบุรี', region: 'ภาคกลาง', usage: 117.78, client: 165, date: '2025-08-11', availability: 3.3 },
            { name: '7-11 รพ.บางละมุง (18061)', province: 'ชลบุรี', region: 'ภาคตะวันออก', usage: 69.75, client: 370, date: '2025-08-05', availability: 190 },
            { name: '7-11 ข้างบิ๊กซีอุบล (9035)', province: 'อุบลราชธานี', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 56.91, client: 39, date: '2025-08-10', availability: 136.7 },
            { name: '7-11 ตลาดเซฟวัน จุด 2 (10165)', province: 'นครราชสีมา', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 48.65, client: 216, date: '2025-08-02', availability: 56.7 },
            { name: '7-11 ปตท.หนองเสม็ด (11046)', province: 'ตราด', region: 'ภาคตะวันออก', usage: 48.06, client: 147, date: '2025-08-03', availability: 153.3 },
            { name: '7-11 ปตท.เทพารักษ์ กม.15 (10221)', province: 'สมุทรปราการ', region: 'ภาคกลาง', usage: 44.82, client: 243, date: '2025-08-03', availability: 120 },
            { name: '7-11 ปตท.วังน้อย (11030)', province: 'พระนครศรีอยุธยา', region: 'ภาคกลาง', usage: 43.19, client: 254, date: '2025-08-03', availability: 20 },
            { name: '7-11 ตลาดสดเทศบาลระนอง (10015)', province: 'ระนอง', region: 'ภาคใต้', usage: 42.14, client: 261, date: '2025-08-10', availability: 36.7 },
            { name: '7-11 ปตท.บายพาสชลบุรี (10196)', province: 'ชลบุรี', region: 'ภาคตะวันออก', usage: 40.76, client: 350, date: '2025-08-12', availability: 33.3 },
            { name: '7-11 ตลาดสดคลองด่าน (4473)', province: 'สมุทรปราการ', region: 'ภาคกลาง', usage: 39.5, client: 167, date: '2025-08-01', availability: 53.3 },
            { name: '7-11 ท่ารถ บขส.เชียงราย (10014)', province: 'เชียงราย', region: 'ภาคเหนือ', usage: 37.74, client: 249, date: '2025-08-11', availability: 3.3 },
            { name: '7-11 ปตท.บายพาสสระบุรี (10006)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 37.37, client: 284, date: '2025-08-02', availability: 56.7 },
            { name: '7-11 ปตท.บางปะอิน (10005)', province: 'พระนครศรีอยุธยา', region: 'ภาคกลาง', usage: 36.6, client: 236, date: '2025-08-05', availability: 190 },
            { name: '7-11 ซอยเนินพลับหวาน (11116)', province: 'ชลบุรี', region: 'ภาคตะวันออก', usage: 35.8, client: 251, date: '2025-08-10', availability: 136.7 },
            { name: '7-11 ปตท.หนองแค (10007)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 35.78, client: 260, date: '2025-08-10', availability: 36.7 },
            { name: '7-11 ปตท.เมืองตราด (11045)', province: 'ตราด', region: 'ภาคตะวันออก', usage: 35.2, client: 141, date: '2025-08-12', availability: 33.3 },
            { name: '7-11 ตลาดนัดเรือบิน (12988)', province: 'สมุทรปราการ', region: 'ภาคกลาง', usage: 33.91, client: 172, date: '2025-08-03', availability: 153.3 },
            { name: '7-11 ปตท.วังน้อย (ขาเข้า) (10004)', province: 'พระนครศรีอยุธยา', region: 'ภาคกลาง', usage: 33.7, client: 240, date: '2025-08-03', availability: 20 },
            { name: '7-11 ปตท.บายพาสชลบุรี (ขาเข้า) (10197)', province: 'ชลบุรี', region: 'ภาคตะวันออก', usage: 33.5, client: 320, date: '2025-08-03', availability: 120 },
            { name: '7-11 ปตท.แก่งคอย (10008)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 32.9, client: 250, date: '2025-08-01', availability: 53.3 },
            { name: '7-11 ชุมชนบ้านหนองบัว (10222)', province: 'กาญจนบุรี', region: 'ภาคตะวันตก', usage: 32.8, client: 150, date: '2025-08-11', availability: 3.3 },
            { name: '7-11 ตลาดโต้รุ่งหัวหิน (10012)', province: 'ประจวบคีรีขันธ์', region: 'ภาคตะวันตก', usage: 32.5, client: 280, date: '2025-08-02', availability: 56.7 },
            { name: '7-11 ปตท.บายพาสสระบุรี (ขาเข้า) (10009)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 31.9, client: 270, date: '2025-08-05', availability: 190 },
            { name: '7-11 ตลาดสดเทศบาลนครสวรรค์ (10013)', province: 'นครสวรรค์', region: 'ภาคกลาง', usage: 31.5, client: 230, date: '2025-08-10', availability: 136.7 },
            { name: '7-11 ปตท.บางปะอิน (ขาเข้า) (10003)', province: 'พระนครศรีอยุธยา', region: 'ภาคกลาง', usage: 31.2, client: 220, date: '2025-08-10', availability: 36.7 },
            { name: '7-11 ปตท.หนองแค (ขาเข้า) (10010)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 30.8, client: 240, date: '2025-08-12', availability: 33.3 },
            { name: '7-11 ปตท.แก่งคอย (ขาเข้า) (10011)', province: 'สระบุรี', region: 'ภาคกลาง', usage: 30.5, client: 230, date: '2025-08-03', availability: 153.3 },
            { name: '7-11 ตลาดโรงเกลือ (10016)', province: 'สระแก้ว', region: 'ภาคตะวันออก', usage: 30.2, client: 290, date: '2025-08-03', availability: 20 },
            { name: '7-11 ตลาดอินโดจีน (10017)', province: 'มุกดาหาร', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 29.8, client: 270, date: '2025-08-03', availability: 120 },
            { name: '7-11 ตลาดช่องจอม (10018)', province: 'สุรินทร์', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 29.5, client: 260, date: '2025-08-01', availability: 53.3 },
            { name: '7-11 ตลาดโรงเกลือ (เก่า) (10019)', province: 'สระแก้ว', region: 'ภาคตะวันออก', usage: 29.2, client: 280, date: '2025-08-11', availability: 3.3 },
            { name: '7-11 ตลาดอินโดจีน (เก่า) (10020)', province: 'มุกดาหาร', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 28.8, client: 250, date: '2025-08-02', availability: 56.7 },
            { name: '7-11 ตลาดช่องจอม (เก่า) (10021)', province: 'สุรินทร์', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 28.5, client: 240, date: '2025-08-05', availability: 190 },
            { name: '7-11 รามอินทรา 40 แยก 11 (22680)', province: 'กรุงเทพมหานคร', region: 'ภาคกลาง', usage: 25.63, client: 99, date: '2025-08-10', availability: 136.7 },
            { name: '7-11 ปตท.สี่แยกบ้านบัว (10144)', province: 'ร้อยเอ็ด', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 25.59, client: 143, date: '2025-08-10', availability: 36.7 },
            { name: '7-11 นวลจันทร์ 56 (18169)', province: 'กรุงเทพมหานคร', region: 'ภาคกลาง', usage: 25.43, client: 92, date: '2025-08-12', availability: 33.3 },
            { name: '7-11 บ้านเตว็ด (22722)', province: 'สุโขทัย', region: 'ภาคกลาง', usage: 25.13, client: 49, date: '2025-08-03', availability: 153.3 },
            { name: '7-11 ปตท.ไทยเพิ่มพูนร้อยเอ็ด (011485)', province: 'ร้อยเอ็ด', region: 'ภาคตะวันออกเฉียงเหนือ', usage: 25, client: 120, date: '2025-08-03', availability: 20 },
        ].filter(b => b.province !== '#VALUE!' && b.region !== '#VALUE!');

        // --- Data Aggregation and Sorting ---
        // Availability Data
        const availabilityRawData = allBranchesData.map(d => ({ date: d.date, percent: d.availability }));
        availabilityRawData.sort((a, b) => new Date(a.date) - new Date(b.date));
        const daysInMonth = availabilityRawData.map(d => new Date(d.date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }));
        const availabilityData = availabilityRawData.map(d => d.percent > 100 ? 100 : d.percent); // Cap data at 100
        const avgAvailability = (availabilityData.reduce((a, b) => a + b, 0) / availabilityData.length).toFixed(2);
        document.getElementById('avgAvailability').textContent = `${avgAvailability}%`;

        // Top 20 Usage
        const sortedByUsage = [...allBranchesData].sort((a, b) => b.usage - a.usage).slice(0, 20);
        const top20UsageData = {
            labels: sortedByUsage.map(b => b.name),
            data: sortedByUsage.map(b => b.usage)
        };
        // Top 20 Clients
        const sortedByClient = [...allBranchesData].sort((a, b) => b.client - a.client).slice(0, 20);
        const top20ClientData = {
            labels: sortedByClient.map(b => b.name),
            data: sortedByClient.map(b => b.client)
        };
        // Region Summary
        const regionSummary = allBranchesData.reduce((acc, branch) => { const region = branch.region; if (region) { if (!acc[region]) { acc[region] = { client: 0, usage: 0 }; } acc[region].client += branch.client; acc[region].usage += branch.usage; } return acc; }, {});
        // Province Summary
        const provinceSummary = allBranchesData.reduce((acc, branch) => { const province = branch.province; if (province) { if (!acc[province]) { acc[province] = { client: 0, usage: 0 }; } acc[province].client += branch.client; acc[province].usage += branch.usage; } return acc; }, {});
        
        // --- Chart Rendering ---
        const availabilityCtx = document.getElementById('availabilityChart').getContext('2d');
        new Chart(availabilityCtx, { type: 'line', data: { labels: daysInMonth, datasets: [{ label: 'Availability (%)', data: availabilityData, borderColor: secondaryBorderColor, backgroundColor: 'rgba(75, 192, 192, 0.2)', fill: true, tension: 0.4, pointRadius: 2, pointBackgroundColor: secondaryBorderColor }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 100, ticks: { callback: (value) => value + '%' } }, x: { ticks: { maxRotation: 0, minRotation: 0, autoSkip: true, maxTicksLimit: 15 } } }, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => `Availability: ${context.raw.toFixed(2)}%` } } } } });
        
        const faultZoneCtx = document.getElementById('faultZoneChart').getContext('2d');
        new Chart(faultZoneCtx, { type: 'doughnut', data: { labels: faultZones, datasets: [{ label: 'จำนวน Faults', data: faultData, backgroundColor: professionalColors, hoverOffset: 4, borderWidth: 2, borderColor: '#ffffff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12, usePointStyle: true, pointStyle: 'circle' } } } } });
        
        const topUsageCtx = document.getElementById('topUsageChart').getContext('2d');
        new Chart(topUsageCtx, { type: 'bar', data: { labels: top20UsageData.labels, datasets: [{ label: 'Usage (GB)', data: top20UsageData.data, backgroundColor: primaryColor, borderColor: primaryBorderColor, borderWidth: 1, borderRadius: 4 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, title: { display: true, text: 'Usage (GB)' } } } } });
        
        const topUsersCtx = document.getElementById('topUsersChart').getContext('2d');
        new Chart(topUsersCtx, { type: 'bar', data: { labels: top20ClientData.labels, datasets: [{ label: 'จำนวน Client', data: top20ClientData.data, backgroundColor: secondaryColor, borderColor: secondaryBorderColor, borderWidth: 1, borderRadius: 4 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, title: { display: true, text: 'จำนวน Client (คน)' } } } } });

        const regionClientCtx = document.getElementById('regionClientChart').getContext('2d');
        const regionLabels = Object.keys(regionSummary);
        const regionClientData = regionLabels.map(region => regionSummary[region].client);
        new Chart(regionClientCtx, {
            type: 'pie',
            data: {
                labels: regionLabels,
                datasets: [{
                    label: 'จำนวน Client',
                    data: regionClientData,
                    backgroundColor: professionalColors,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        const provinceUsageCtx = document.getElementById('provinceUsageChart').getContext('2d');
        const sortedProvinces = Object.entries(provinceSummary).sort(([,a],[,b]) => b.usage - a.usage).slice(0, 10);
        const provinceLabels = sortedProvinces.map(p => p[0]);
        const provinceUsageData = sortedProvinces.map(p => p[1].usage.toFixed(2));
        new Chart(provinceUsageCtx, {
            type: 'bar',
            data: {
                labels: provinceLabels,
                datasets: [{
                    label: 'Usage (GB)',
                    data: provinceUsageData,
                    backgroundColor: accentColor,
                    borderColor: accentBorderColor,
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { beginAtZero: true, title: { display: true, text: 'Usage (GB)' } } }
            }
        });

        const provinceClientCtx = document.getElementById('provinceClientChart').getContext('2d');
        const sortedProvincesByClient = Object.entries(provinceSummary).sort(([,a],[,b]) => b.client - a.client);
        const top7Provinces = sortedProvincesByClient.slice(0, 7);
        const otherProvincesClient = sortedProvincesByClient.slice(7).reduce((sum, current) => sum + current[1].client, 0);
        const provinceClientLabels = top7Provinces.map(p => p[0]);
        const provinceClientData = top7Provinces.map(p => p[1].client);
        if (otherProvincesClient > 0) {
            provinceClientLabels.push('อื่น ๆ');
            provinceClientData.push(otherProvincesClient);
        }
        new Chart(provinceClientCtx, {
            type: 'pie',
            data: {
                labels: provinceClientLabels,
                datasets: [{
                    label: 'จำนวน Client',
                    data: provinceClientData,
                    backgroundColor: professionalColors,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        const regionUsageCtx = document.getElementById('regionUsageChart').getContext('2d');
        const sortedRegionsByUsage = Object.entries(regionSummary).sort(([,a],[,b]) => b.usage - a.usage);
        const regionUsageLabels = sortedRegionsByUsage.map(r => r[0]);
        const regionUsageData = sortedRegionsByUsage.map(r => r[1].usage.toFixed(2));
        new Chart(regionUsageCtx, {
            type: 'bar',
            data: {
                labels: regionUsageLabels,
                datasets: [{
                    label: 'Usage (GB)',
                    data: regionUsageData,
                    backgroundColor: primaryColor,
                    borderColor: primaryBorderColor,
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { beginAtZero: true, title: { display: true, text: 'Usage (GB)' } } }
            }
        });

        // --- New Chart: Lowest Availability ---
        const lowestAvailabilityCtx = document.getElementById('lowestAvailabilityChart').getContext('2d');
        const sortedByLowestAvailability = [...allBranchesData]
            .sort((a, b) => a.availability - b.availability) // Ascending sort
            .slice(0, 10);

        const lowestAvailabilityLabels = sortedByLowestAvailability.map(b => b.name);
        const lowestAvailabilityData = sortedByLowestAvailability.map(b => b.availability);

        new Chart(lowestAvailabilityCtx, {
            type: 'bar',
            data: {
                labels: lowestAvailabilityLabels,
                datasets: [{
                    label: 'Availability (%)',
                    data: lowestAvailabilityData,
                    backgroundColor: dangerColor,
                    borderColor: dangerBorderColor,
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: { display: true, text: 'Availability (%)' }
                    }
                }
            }
        });

    </script>
</body>
</html>
